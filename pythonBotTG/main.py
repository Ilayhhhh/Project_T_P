import telebot
from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton

API = "7797110821:AAFjgZLUAot0Gir_ke_Zml4enBUNkKe1pLg"
bot = telebot.TeleBot(API)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏
def create_main_menu():
    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", callback_data="info"))
    markup.add(InlineKeyboardButton("–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", callback_data="calculate"))
    markup.add(InlineKeyboardButton("–°–æ–≤–µ—Ç—ã", callback_data="soveti"))
    return markup

@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.reply_to(message, f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.first_name}. –≠—Ç–æ Telegram-–±–æ—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–∞–ª–æ—Ä–∏–π, –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤! –ó–¥–µ—Å—å –í—ã —Å–º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –∏ –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π –≤ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏.", reply_markup=create_main_menu())

@bot.callback_query_handler(func=lambda call: call.data == "info")
def send_info(call):
    bot.answer_callback_query(call.id)  # –£–±–∏—Ä–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –≤–Ω–∏–∑—É
    bot.send_message(call.message.chat.id, "–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤–∞—à–µ–º—É –≤–Ω–∏–º–∞–Ω–∏—é –±–æ—Ç –≤ Telegram, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–Ω–µ—Ç –Ω–µ–∑–∞–º–µ–Ω–∏–º—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –≤ –∫–æ–Ω—Ç—Ä–æ–ª–µ –≤–∞—à–µ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏. –û–Ω —Å–ø–æ—Å–æ–±–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç—å, –±–µ–ª–∫–∏, –∂–∏—Ä—ã –∏ —É–≥–ª–µ–≤–æ–¥—ã (–ö–ë–ñ–£) –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ –≤–µ—Å, —Ä–æ—Å—Ç, –≤–æ–∑—Ä–∞—Å—Ç –∏ —É—Ä–æ–≤–µ–Ω—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏ –±–æ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç –≤–∞–º —Ç–æ—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–ª–∏–∫ –¥–µ–ª–∞—é—Ç –æ–±—â–µ–Ω–∏–µ —Å –±–æ—Ç–æ–º –ª–µ–≥–∫–∏–º –∏ –ø—Ä–∏—è—Ç–Ω—ã–º. –ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å —Ç–µ–ª–æ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!")

@bot.callback_query_handler(func=lambda call: call.data == "calculate")
def ask_for_data(call):
    bot.answer_callback_query(call.id)
    bot.send_message(call.message.chat.id, "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ - –ø–æ–ª, –≤–µ—Å, —Ä–æ—Å—Ç, –≤–æ–∑—Ä–∞—Å—Ç –∏ —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≥–¥–µ —É—Ä–æ–≤–µ–Ω—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤: \n 1( –ú–∞–ª–æ–ø–æ–¥–≤–∏–∂–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏) \n 2(–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å) \n 3(–ê–∫—Ç–∏–≤–Ω–æ –∑–∞–Ω–∏–º–∞—é—â–∏–π—Å—è —Å–ø–æ—Ä—Ç–æ–º).\n\n –ü—Ä–∏–º–µ—Ä: –∂ 65 170 25 2")

@bot.message_handler(func=lambda message: len(message.text.split()) == 5)
def calculate_kbju(message):
    try:
        # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —á–∞—Å—Ç–∏
        data = message.text.split()
        if len(data) != 5:
            raise ValueError("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –í–≤–µ–¥–∏—Ç–µ –ø—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: –ø–æ–ª, –≤–µ—Å, —Ä–æ—Å—Ç, –≤–æ–∑—Ä–∞—Å—Ç –∏ —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.")

        sex = data[0].lower()  # –ø–æ–ª
        ves = float(data[1])  # –≤–µ—Å
        rost = float(data[2])  # —Ä–æ—Å—Ç
        vozr = float(data[3])  # –≤–æ–∑—Ä–∞—Å—Ç
        activity_level = int(data[4])  # —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

        if ves <= 0 or rost <= 0 or vozr <= 0:
            raise ValueError("–í–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏")

        if sex == '–º':
            bmr = 9 * ves + 6.25 * rost - 5 * vozr + 5  # –§–æ—Ä–º—É–ª–∞ –¥–ª—è –º—É–∂—á–∏–Ω
        elif sex == '–∂':
            bmr = 9 * ves + 6.25 * rost - 5 * vozr - 161  # –§–æ—Ä–º—É–ª–∞ –¥–ª—è –∂–µ–Ω—â–∏–Ω
        else:
            raise ValueError("–ü–æ–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å '–º' –¥–ª—è –º—É–∂—á–∏–Ω –∏–ª–∏ '–∂' –¥–ª—è –∂–µ–Ω—â–∏–Ω.")

        # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        activity_mul = {
            1: 1.1,   # –º–∞–ª–æ–ø–æ–¥–≤–∏–∂–Ω—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏
            2: 1.3,  # —É–º–µ—Ä–µ–Ω–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã–π
            3: 1.5    # –∞–∫—Ç–∏–≤–Ω–æ –∑–∞–Ω–∏–º–∞—é—â–∏–π—Å—è —Å–ø–æ—Ä—Ç–æ–º
        }

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        if activity_level not in activity_mul:
            raise ValueError("–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1, 2 –∏–ª–∏ 3.")

        # –£—á–∏—Ç—ã–≤–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        tdee = bmr * activity_mul[activity_level]

        # –†–∞—Å—á–µ—Ç –ö–ë–ñ–£ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 40% —É–≥–ª–µ–≤–æ–¥—ã, 30% –±–µ–ª–∫–∏, 30% –∂–∏—Ä—ã)
        ugl = tdee * 0.4 / 4  # —É–≥–ª–µ–≤–æ–¥—ã
        belk = tdee * 0.3 / 5  # –±–µ–ª–∫–∏
        jir = tdee * 0.3 / 8    # –∂–∏—Ä—ã

        response = (f"–í–∞—à–∞ –¥–Ω–µ–≤–Ω–∞—è –Ω–æ—Ä–º–∞ –ö–ë–ñ–£:\n"
                    f"–ö–∞–ª–æ—Ä–∏–∏: {tdee:.2f} –∫–∫–∞–ª\n"
                    f"–£–≥–ª–µ–≤–æ–¥—ã: {ugl:.2f} –≥\n"
                    f"–ë–µ–ª–∫–∏: {belk:.2f} –≥\n"
                    f"–ñ–∏—Ä—ã: {jir:.2f} –≥")
        bot.reply_to(message, response)

    except Exception as e:
        bot.reply_to(message, str(e))
user_states = {}  # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@bot.callback_query_handler(func=lambda call: call.data == "soveti")
def ask_for_proda(call):
    user_states[call.message.chat.id] = 'waiting_for_response'  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    bot.answer_callback_query(call.id)
    bot.send_message(call.message.chat.id, "–ú—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –ø–∏—Ç–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.")
    bot.send_message(call.message.chat.id, "–î–ª—è –Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ —É—Ç–æ—á–Ω–∏–º: \n 1-–Ø –Ω–µ –∏—Å–∫–ª—é—á–∞—é –∏–∑ —Å–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ –Ω–∏–∫–∞–∫–æ–π —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤\n 2-–Ø –∏—Å–∫–ª—é—á–∞—é –∏–∑ —Å–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ –º—è—Å–æüçñ‚ùå\n 3-–Ø –∏—Å–∫–ª—é—á–∞—é –∏–∑ —Å–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ãü•õ‚ùå\n 4-–Ø –∏—Å–∫–ª—é—á–∞—é –∏–∑ —Å–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ –º—è—Å–Ω—ã–µ –∏ –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã üçñü•õ‚ùå\n \n –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤–∞—à–µ–≥–æ –≤—ã–±–æ—Ä–∞:")

@bot.message_handler(func=lambda message: user_states.get(message.chat.id) == 'waiting_for_response')
def handle_user_response(message):
    if message.text == "1":
        bot.send_message(message.chat.id, "–î–ª—è –ª—é–¥–µ–π, –Ω–µ –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –Ω–∏—á–µ–≥–æ –∏–∑ —Å–≤–æ–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.\n 1)–†–æ–ª–∏–∫ —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–∏—Ç–∞–Ω–∏—é https://yandex.ru/video/preview/17504274598371715017 \n 2)–ü—Ä–∏–Ω—Ü–∏–ø—ã –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –æ—Ç –†–û–°–ü–û–¢–†–ï–ë–ù–ê–î–ó–û–†–ê https://14.rospotrebnadzor.ru/content/2090/79455/ \\n 3) 1000 —Ä–µ—Ü–µ–ø—Ç–æ–≤ –¥–æ–º–∞—à–Ω–∏—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è https://1000.menu/catalog/sbalansirovannoe-pitanie")
    elif message.text.lower() == "2":
        bot.send_message(message.chat.id,
                         "–î–ª—è –ª—é–¥–µ–π, –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –º—è—Å–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.\n 1)–†–æ–ª–∏–∫ —Å —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –±–µ–∑ –º—è—Å–∞ https://youtu.be/KPO0A90XqzE \n 2)–ß–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –º—è—Å–æ https://rutube.ru/video/8a225add9e7d4800501e4d73e2a86756/?r=plwd \n 3)–ü–ü –±–ª—é–¥–∞ –±–µ–∑ –º—è—Å–∞ https://1000.menu/meals/9022-10427")
    elif message.text.lower() == "3":
        bot.send_message(message.chat.id,
                         "–î–ª—è –ª—é–¥–µ–π, –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.\n 1)–†–æ–ª–∏–∫ –æ —Ç–æ–º —á–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã https://yandex.ru/video/preview/13100322906635975298 \n 2) –†–µ—Ü–µ–ø—Ç—ã –±–µ–∑ –º–æ–ª–æ—á–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ https://www.edimdoma.ru/retsepty/tags/9056-pp-retsepty-bez-molochnyh-produktov \n 3)–†–∞—Ü–∏–æ–Ω –ø–∏—Ç–∞–Ω–∏—è –±–µ–∑ –º–æ–ª–æ–ª—á–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ https://dgp6-omsk.ru/ru/racion-pitanija-bez-molochnyh-produktov")
    elif message.text.lower() == "4":
        bot.send_message(message.chat.id,
                         "–î–ª—è –ª—é–¥–µ–π, –∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –º—è—Å–Ω—ã–µ –∏ –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.\n 1) –†–æ–ª–∏–∫ –æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–º –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é https://yandex.ru/video/preview/3342349212361481234 \n 2) –ö–∞–∫ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ—Ä–≤–∞—Ç—å —Ä–∞—Ü–∏–æ–Ω https://77.rospotrebnadzor.ru/index.php/press-centr/186-press-centr/12308-vegetarianstvo-kak-sbalansirovat-ratsion-01-11-2023 \n 3) –†–µ—Ü–µ–ø—Ç—ã, –∏—Å–∫–∞–ª—é—á–∞—é—â–∏–µ –º—è—Å–Ω—ã–µ –∏ –º–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã https://1000.menu/meals/13-4717")
    user_states[message.chat.id] = None  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞
try:
    bot.polling(none_stop=True)
except Exception as e:
    print(f"Error:{e}")
